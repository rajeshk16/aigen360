"use strict";$((function(){let e;$(document).on("select2:select",".filter-column",(function(i){i.stopPropagation(),e=$(this).closest(".filter-query-container").data("prefix");let o=$(this).val(),a=n($(this).closest(".filter-query-container").find(".filter-type").val());if(!queryOperations[a].hasOwnProperty(o))return;let l="query"===a?r(queryOperations.query[o]):t(),s="query"===a?"operation":"order",c="query"===a?"order":"operation";$(this).closest(".filter-query-container").find(".filter-"+c+"-container").removeClass("filter-"+c+"-container").addClass("filter-"+s+"-container"),$(this).closest(".filter-query-container").find(".filter-"+s+"-container").html(l),$(this).closest(".filter-query-container").find(".filter-"+s).select2(),$(this).closest(".filter-query-container").find(".filter-value-container").html("")}));const t=()=>`\n            <select class="select2 filter-order" name="${l("order")}">\n                <option value="asc">${jsLang("ASC")}</option>\n                <option value="desc">${jsLang("DESC")}</option>\n            </select>\n        `,n=e=>"where"===e||"orWhere"===e?"query":"order";$(document).on("select2:selecting",".filter-type",(function(e){$(this).attr("data-prev",$(this).val())})),$(document).on("select2:select",".filter-type",(function(t){if(t.stopPropagation(),$(this).attr("data-prev")&&n($(this).attr("data-prev"))==n($(this).val()))return;e=$(this).closest(".filter-query-container").data("prefix");let r=n($(this).val());if(!queryOperations.hasOwnProperty(r))return;let o=i(queryOperations[r]);$(this).closest(".filter-query-container").find(".filter-column-container").html(o),$(this).closest(".filter-query-container").find(".filter-column").select2({}),$(this).closest(".filter-query-container").find(".filter-value-container, .filter-order-container, .filter-operation-container").html("")}));const i=e=>{let t=`<select class="select2 filter-column" name="${l("column")}">`;t+=`<option value="" selected disabled>${jsLang("Column")}</option>`;for(const n in e)t+=`<option value="${n}">${e[n].name}</option>`;return t+"</select>"},r=e=>{let t=e.operations,n=`<select class="select2 filter-operation" name="${l("operation")}">`;n+=`<option value="" selected disabled>${jsLang("Operation")}</option>`;for(const e in t)n+=o(t[e]);return n+="</select>",n},o=e=>a(e),a=e=>`<option value="${e.value}">${e.name}</option>`,l=t=>`${e}[${t}]`,s=e=>`\n            <input class="single-date-picker form-control filter-value ${e.class}" placeholder="${e.placeholder}" name="${l("value")}">\n        `,c=e=>{let t="";for(const n in e.options)t+=`<option value="${n}">${e.options[n]}</option>`;return t},d=e=>$(`<select class="select2 filter-value ${e.class}" placeholder="${e.placeholder??""}" name="${l("value")+("multiple"==e.multiple?"[]":"")}" ${"multiple"==e.multiple?"multiple":""}></select>`);$(document).on("select2:select",".filter-operation",(function(){let t=$(this).closest(".filter-query-container").find(".filter-column").val();e=$(this).closest(".filter-query-container").data("prefix");let n=$(this).val(),i=queryOperations.query[t].operations[n];if(null==!i)return;let r=(e=>{let t,n=e.input;return"select"==n.type?(1==n.ajax&&(n.class+=" has-ajax-query"),t=d(n),n.options&&$(t).append(c(n))):"date"==n.type&&(t=s(n)),t})(i);$(this).closest(".filter-query-container").find(".filter-value-container").html(r),u($(this).closest(".filter-query-container"))}));const u=e=>{let t=$(e).find(".filter-value");if(t.hasClass("has-ajax-query")){let t=p(e);$(e).find(".filter-value").select2({ajax:{url:ajaxResourceUrl+t,dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,t){return{results:e.data}},cache:!0},placeholder:jsLang("Search by name"),minimumInputLength:3,tags:!1})}else t.hasClass("single-date-picker")?(e=>{$(e).find(".single-date-picker").daterangepicker(clearableDateRangePickerConf({autoUpdateInput:!0,showDropdowns:!0,minDate:null}))})(e):t.hasClass("select2")&&$(e).find(".filter-value").select2({})},p=e=>{let t="?";return t+=`column=${encodeURIComponent($(e).find(".filter-column").val())}`,t};$(".filter-query-container").each((function(){u(this)})),$(document).on("click",".__query.add-row-btn",(function(){let e=$(this).data("index");if(null==e)return;let t=$(f({index:parseInt(e)}));$(this).closest(".filter-query-container").parent().append(t),$(t).find(".select2").select2({}),0==$(this).closest(".accordion-action-group").find(".remove-row-btn").length&&$(h(e)).insertAfter($(this)),$(this).remove()}));const f=(e={})=>null!=e.index&&`\n    <div class="card mb-3 filter-query-container" data-prefix="query[${e.index}]" data-next="${e.index+1}">\n                    <div class="card-header p-2" id="headingOne">\n                        <div class="mb-0 row">\n                            <div class="col-md-2 col-12 filter-type-container">\n                                <select name="query[${e.index}][type]" class="select2 filter-type">\n                                <option value="" disabled selected>${jsLang("Query")}</option>\n                                    <option value="where">${jsLang("Where")}</option>\n                                    <option value="orWhere">${jsLang("Or Where")}</option>\n                                    <option value="orderBy">${jsLang("Order By")}</option>\n                                </select>\n                            </div>\n                            <div class="col-md-4 col-12 filter-column-container">\n                            </div>\n                            <div class="col-md-2 col-12 filter-operation-container">\n                            </div>\n                            <div class="col-md-4 col-12 filter-value-container">\n                            </div>\n                            <span class="b-icon">\n                                <span class="accordion-action-group">\n                                    <span class="accordion-row-action add-row-btn __query __private"\n                                        data-index="${e.index+1}"><i class="feather icon-plus"></i>\n                                    </span>\n                                    <span class="accordion-row-action remove-row-btn __private __query"  data-index="${e.index+1}"><i class="feather icon-minus"></i>\n                                    </span>\n                                </span>\n                            </span>\n                        </div>\n                    </div>\n                </div>\n    `,h=e=>`<span class="accordion-row-action remove-row-btn __private __query"  data-index="${e+1}"><i class="feather icon-minus"></i>\n    </span>`;$(document).on("click",".__query.remove-row-btn",(function(){if($(this).closest(".accordion-action-group").find(".add-row-btn").length>0){let e=parseInt($(this).data("index"));$(this).closest(".filter-query-container").prev().find(".accordion-action-group").append((e=>`<span class="accordion-row-action add-row-btn __query __private"\n            data-index="${e+1}"><i class="feather icon-plus"></i>\n        </span>`)(e))}let e=$(this).closest(".accordion").children();$(this).closest(".filter-query-container").remove(),2===e.length&&e.find(".remove-row-btn").remove()}))}));