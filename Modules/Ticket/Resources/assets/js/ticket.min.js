"use strict";if($(".select2").select2(),$(".main-body .page-wrapper").find("#add-ticket-container").length){var theEditor;function selectedCustomer(){$("#assign_name").val($("#customer_id option:selected").attr("data-name")),$("#assign_email").val($("#customer_id option:selected").attr("data-email"))}$(document).on("change","#customer_id",(function(){selectedCustomer()})),""!=projectId&&$("#project_id, #customer_id").prop("disabled",!0),$("body").on("click",".delete_file_field",(function(){$(this).parents(".control-group").remove()})),validateCKEditor("#ticket_messages","#ticket_messages-error"),$("#add_ticket_form").validate({ignore:[],rules:{subject:{required:!0},project_id:{required:!0},assign_id:{required:!0},priority_id:{required:!0},customer_id:{required:function(){return"yes"!=$("#flag").val()}}}}),$("select").on("change",(function(){""!=$(this).val()&&$(this).valid(),$("#project_id").on("change",(function(){var project_id=$("#project_id").val();$.ajax({method:"get",url:SITE_URL+"/ticket/check-inhouse-project",data:{id:project_id}}).done((function(msg){"yes"==msg?($(".select-customer-div, .customer-info-div").hide(),$("#flag").val("yes")):($(".select-customer-div, .customer-info-div").show(),$("#flag").val("no"))}))}))})),deleteAttachment(SITE_URL+"/file/remove?type=ticket_reply"),uploadAttachment(SITE_URL+"/file/upload?type=ticket_reply","#customer_id"),$("#add_ticket_btn").on("click",(function(){1==$("#add_ticket_form").valid()&&($(".spinner").show().css("line-height","0"),$("#spinnerText").text(jsLang("Please wait...")),$(this).attr("disabled",!0),$("#add_ticket_form").trigger("submit"))}))}if($(".main-body .page-wrapper").find("#edit-ticket-container").length&&($((function(){$("#assign_name").val($("#customer_id option:selected").attr("data-name")),$("#assign_email").val($("#customer_id option:selected").attr("data-email"))})),$(document).on("change","#customer_id",(function(){$("#assign_name").val($("option:selected",this).attr("data-name")),$("#assign_email").val($("option:selected",this).attr("data-email"))})),$("body").on("click",".delete_file_field",(function(){$(this).parents(".control-group").remove()})),$("#edit-ticket-form").validate({ignore:[],rules:{subject:{required:!0},project_id:{required:!0},assign_id:{required:!0},priority_id:{required:!0},customer_id:{required:!0}}}),$("select").on("change",(function(){""!=$(this).val()&&$(this).valid()}))),$(".main-body .page-wrapper").find("#ticket-list-container").length&&($("#daterange-btn").daterangepicker(daterangeConfig(startDate,endDate),cbRange),cbRange(startDate,endDate),$(document).on("click","#csv",(function(event){event.preventDefault(),window.location=SITE_URL+"/ticket_csv?from="+$("#startfrom").val()+"&to="+$("#endto").val()+"&project="+$("#project").val()+"&status="+$("#status").val()+"&assignee="+$("#assignee").val()})),$(document).on("click","#pdf",(function(event){event.preventDefault(),window.location=SITE_URL+"/ticket_pdf?from="+$("#startfrom").val()+"&to="+$("#endto").val()+"&project="+$("#project").val()+"&status="+$("#status").val()+"&assignee="+$("#assignee").val()})),$("#theModal").on("show.bs.modal",(function(e){var button=$(e.relatedTarget),modal=$(this);$("#theModalSubmitBtn").attr("data-task","").removeClass("delete-task-btn"),"Delete"==button.data("label")?(modal.find("#theModalSubmitBtn").addClass("delete-task-btn").attr("data-task",button.data("id")).text(jsLang("Delete")).show(),modal.find("#theModalLabel").text(button.data("title")),modal.find(".modal-body").text(button.data("message"))):(modal.find(".modal-body").html('<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>'),modal.find(".modal-body").load(button.data("remote")))})),$("#theModalSubmitBtn").on("click",(function(){$("#delete-item-"+$(this).data("task")).trigger("submit")})),$(window).on("load",(function(){$(window).width()<576&&$("#headerDiv").addClass("pb-3")})),$("body").tooltip({selector:'[data-toggle="tooltip"]'}),$(document).on("click",".ticket_status_change",(function(){var statusId=$(this).attr("data-id"),ticketId=$(this).attr("ticket_id"),ticketName=$(this).attr("data-value");ticketStatusChange(SITE_URL+"/ticket/change-status",statusId,ticketId,ticketName)}))),$(".main-body .page-wrapper").find("#reply-ticket-container1").length){var stack=[],editorValue,editorNote;hideNoDiv(),$(document).on("click",".status_change",(function(){var status_id=$(this).attr("data-id"),ticketId=$(this).attr("ticket_id");$.ajax({url:SITE_URL+"/ticket/change-status",method:"POST",data:{status_id:status_id,ticketId:ticketId,_token:token},dataType:"json",success:function(data){if(1==data.status){$("#status_label").html(data.newName),$("#status_label").css("color",data.newStatusColor),$("#ticket-status").html(data.newName),$("#ticket-status").removeClass("text-white").css("color",data.newStatusColor);var statusName=data.newName;$.ajax({url:SITE_URL+"/ticket/get-status",method:"POSt",data:{statusName:statusName,ticketId:ticketId,_token:token},dataType:"json",success:function(data){1==data.status?($("#removeLi ul").empty(),$("#removeLi ul").append(data.output)):swal(jsLang("Something went wrong, please try again."),{icon:"error",buttons:[!1,jsLang("Ok")]})}})}else swal(jsLang("Something went wrong, please try again."),{icon:"error",buttons:[!1,jsLang("Ok")]})}})})),validateCKEditor("#ticket_messages","#ticket_messages-error"),$("#reply_form").validate({ignore:[],rules:{message:{CKEditorRequired:!0}},submitHandler:function(){return $(".spinner").show().css("line-height","0"),$("#spinnerText").text(jsLang("Please wait...")),$("#btnSubmit").attr("disabled",!0),!0}}),$((function(){var name=$("#customer_id option:selected").attr("data-name"),email=$("#customer_id option:selected").attr("data-email");$("#assign_name").val(name)})),ClassicEditor.create(document.querySelector("#reply-modal")).then(editor=>{editorValue=editor,theEditor=intialData=editor.getData(),editor.model.document.on("change",()=>{let editorData=intialData=editor.getData();if(editorData=editorData.replace(/&nbsp;/g,"").replace("<p>","").replace("</p>","").replace(/^\s+|\s+$/g,""),theEditor=editorData,0==editorData.length)return $("#reply-modal-error").show().html(jsLang("This field is required.")),!1;$("#reply-modal-error").hide().html("")})}).catch(error=>{}),$(".edit-btn").on("click",(function(){editorValue.setData($(this).attr("data-message"));var temp=$(".ck-content").children("p.first").val();$("#reply_id").val($(this).attr("data-id")),$("#update_type").val($(this).attr("data-type"))})),$("#replyModal").validate({ignore:[],rules:{message:{CKEditorRequired:!0}}}),ClassicEditor.create(document.querySelector("#txtAreaNote")).then(editor=>{editorNote=editor,theEditor=intialData=editor.getData(),editor.model.document.on("change",()=>{let editorData=intialData=editor.getData();if(editorData=editorData.replace(/&nbsp;/g,"").replace("<p>","").replace("</p>","").replace(/^\s+|\s+$/g,""),theEditor=editorData,0==editorData.length)return $("#txtAreaNote-error").show().html(jsLang("This field is required.")),!1;$("#txtAreaNote-error").hide().html("")})}).catch(error=>{}),$("#noteForm").validate({ignore:[],rules:{message:{CKEditorRequired:!0}}}),$("#modal-note").on("show.bs.modal",(function(){editorNote.setData($("#txtAreaNote").attr("data-message")),$("#txtAreaNote-error").hide()})),$(document).on("change","#assignee",(function(){var user_id=$("#assignee").val()?$("#assignee").val():null,customer_id=$("#customer_id").val(),url=SITE_URL+"/admin/ticket/change-assignee";$.ajax({url:url,method:"POST",data:{user_id:user_id,customer_id:customer_id,ticket_id:ticket_id,_token:token},dataType:"json",beforeSend:function(){swal({title:jsLang("Loading..."),text:$("#assignee option:selected").text()+", "+jsLang("assigning to this ticket"),buttons:!1})},success:function(data){"1"==data.status?($("#assignee").val(user_id).trigger("change"),swal($("#assignee option:selected").text()+jsLang(" successfully assigned"),{icon:"success",buttons:[!1,jsLang("Ok")]})):"2"==data.status&&($("#assignee").val(user_id).trigger("change"),swal(jsLang(" please check your email configuration"),{icon:"error",buttons:[!1,jsLang("Ok")]}))}})})),$("body").on("click",".delete_file_field",(function(){$(this).parents(".control-group").remove()})),deleteAttachment(SITE_URL+"/file/remove"),uploadAttachment(SITE_URL+"/file/upload?type=ticket_reply","#customer_id"),$(document).on("click",".ticket_priority_change",(function(){var priorityId=$(this).attr("data-id"),ticketId=$(this).attr("ticket_id"),ticketName=$(this).attr("data-value");ticketPriorityChange(SITE_URL+"/admin/ticket/priority-status",priorityId,ticketId,ticketName)})),$("#reply_form").validate({ignore:[],rules:{message:{CKEditorRequired:!0}}}),$(document).on("click",".project-name-change",(function(){var projectName=$(this).attr("data-value"),url=SITE_URL+"/ticket/change-project",newUrl=SITE_URL+"/project/details/"+$(this).attr("data-id");$.ajax({url:url,method:"post",data:{projectId:$(this).attr("data-id"),ticketId:$(this).attr("ticket_id"),_token:token},dataType:"json",success:function(data){if(1==data.status)$("#removeLiProject ul").empty(),$("#removeLiProject ul").append(data.output),$(".project-name").html(projectName),$(".project-url").html(projectName),$(".project-url").attr("href",newUrl);else{var html='<div class="alert alert-danger"><button type="button" class="close" data-dismiss="alert">Ã—</button><strong>Something went wrong, please try again.</strong></div>';$(".noti-alert").append(html),$("#notifications").css("display","block")}}})}))}