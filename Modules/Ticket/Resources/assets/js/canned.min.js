"use strict";function clickOnSave(url=null,method=null,data=[]){$.ajax({type:method,url:SITE_URL+url,data:{_token:token,array_value:data},success:function(data){1==data.status?swal(jsLang("Successfully Saved"),{icon:"success",buttons:[!1,jsLang("Ok")]}):(data.error,swal(data.error,{icon:"error",buttons:[!1,jsLang("Ok")]}))}})}function hideNoDiv(){$("#no_div_msg").hide(),$("#no_div_link").hide()}function dataTable(tableSeclector,target){$(tableSeclector).DataTable({columnDefs:[{targets:target,orderable:!1}],language:{url:app_locale_url},pageLength:row_per_page})}function confirmDelete(modalId,buttonId,lebelId,formId){$(modalId).on("show.bs.modal",(function(e){var button=$(e.relatedTarget),modal=$(this);$(buttonId).attr("data-task","").removeClass("delete-task-btn"),"Delete"==button.data("label")&&(modal.find(buttonId).addClass("delete-task-btn").attr("data-task",button.data("id")).text(jsLang("Delete")).show(),modal.find(lebelId).text(button.data("title")),modal.find(".modal-body").text(button.data("message"))),$("#confirmDeleteSubmitBtn").on("click",(function(){$(formId+$(this).data("task")).trigger("submit")}))}))}$(document).ready((function(){function autoCompleteSource(request=null,response=null,url=null,selector=null,divSelector=null){let text=$(selector).val();$.ajax({url:url,dataType:"json",type:"POST",data:{_token:token,search:text},success:function(data){if(1==data.status_no){var data=data.canned;response($.map(data,(function(canned){return{id:canned.id,value:canned.filter_data,fullValue:canned.data}})))}else $(".ui-menu-item").remove(),$(divSelector).css("top",$(selector).position().top+35),$(divSelector).css("left",$(selector).position().left),$(divSelector).css("width",$(selector).width()),$(divSelector).css("display","block")}})}hideNoDiv(),$("#cannedLink_search").autocomplete({delay:500,position:{my:"left top",at:"left bottom",collision:"flip"},source:function(request,response){autoCompleteSource(request,response,SITE_URL+"/canned/search/link","#cannedLink_search","#no_div_link")},select:function(event,ui){var e=ui.item;if(e.id){let setText;return setText=e.value.length>13?e.value+e.fullValue:e.fullValue,$(".txtAreaCanned").summernote("pasteHTML",setText),this.value="",!1}},minLength:1,autoFocus:!0}),$("#cannedMsg_search").autocomplete({delay:500,position:{my:"left top",at:"left bottom",collision:"flip"},source:function(request,response){autoCompleteSource(request,response,SITE_URL+"/canned/search/message","#cannedMsg_search","#no_div_msg")},select:function(event,ui){var e=ui.item;if(e.id){let setText;return setText=e.value.length>13?e.value+e.fullValue:e.fullValue,$(".txtAreaCanned").summernote("pasteHTML",setText),this.value="",!1}},minLength:1,autoFocus:!0}),$(document).on("blur","#cannedMsg_search, #cannedLink_search",(function(){"cannedMsg_search"==$(this).attr("id")?$("#no_div_msg").hide():$("#no_div_link").hide()}))}));var jsonData=[];function isUrlValid(userInput){var res;return null!=userInput.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g)}function customLinkValidation(){let title=0,text_link_check,link,title_ch,link_ch,link_val,title_character_count,link_character_count,link_vlidation,rowId=$("input[name='row_identify[]']").map((function(){return $(this).val()})).get();for(let i=0;i<rowId.length;i++){text_link_check=0,title_character_count=0,link_character_count=0,link_vlidation=0;let text_link_title_check=0;$.each($("#link-title-"+rowId[i]),(function(){$(this).val()&&($(this).val().length<150&&(title_character_count=1),text_link_title_check=1),$("#link-"+rowId[i]).val()&&($("#link-"+rowId[i]).val().length<255&&(link_character_count=1),isUrlValid($("#link-"+rowId[i]).val())&&(link_vlidation=1),text_link_check=1)})),0==text_link_check&&0==link_character_count&&0==link_vlidation?($("#link-"+rowId[i]).addClass("err1"),$("#link-text-"+rowId[i]).text(jsLang("This field is required.")),link=1):1==text_link_check&&0==link_character_count&&0==link_vlidation?($("#link-"+rowId[i]).addClass("err1"),$("#link-text-"+rowId[i]).text(jsLang("Please provide at most 255 characters.")),link_ch=1):1==text_link_check&&1==link_character_count&&0==link_vlidation?($("#link-"+rowId[i]).addClass("err1"),$("#link-text-"+rowId[i]).text(jsLang("Please enter a valid link.")),link_val=1):($("#link-"+rowId[i]).removeClass("err1"),$("#link-text-"+rowId[i]).text("")),0==text_link_title_check&&0==title_character_count?($("#link-title-"+rowId[i]).addClass("err1"),$("#link-title-text-"+rowId[i]).text(jsLang("This field is required.")),title=1):1==text_link_title_check&&0==title_character_count?($("#link-title-"+rowId[i]).addClass("err1"),$("#link-title-text-"+rowId[i]).text(jsLang("Please provide at most 150 characters.")),title_ch=1):($("#link-title-"+rowId[i]).removeClass("err1"),$("#link-title-text-"+rowId[i]).text(""))}return 1!=link&&1!=title&&1!=title_ch&&1!=link_ch&&1!=link_val}if($("#cannedForm").on("submit",(function(event){event.preventDefault();let title=$("#title").val();$(".txtAreaCanned").summernote("codeview.isActivated")&&$(".txtAreaCanned").summernote("codeview.deactivate"),clickOnSave("/canned/messages/save","POST",jsonData={title:title,message:$(".txtAreaCanned:last").summernote("code")}),$("#modal-canned").modal("hide"),document.getElementById("cannedForm").reset(),void 0!==$("#type").val()&&"list"==$("#type").val()&&setTimeout(location.reload.bind(location),1500)})),$(document).on("click",".deleteCustomLink",(function(e){e.preventDefault();var idtodelete=$(this).attr("data-row-id");$("#rowid-"+idtodelete).remove()})),$("#linkForm").on("submit",(function(event){let link,title;event.preventDefault();let flag=0,reload=0;void 0!==$("#type").val()&&"reply"==$("#type").val()?1==customLinkValidation()&&(link=$("input[name='link[]']").map((function(){return $(this).val()})).get(),title=$("input[name='title[]']").map((function(){return $(this).val()})).get(),flag=1,jsonData={title:title,editorValue:link}):1==$("#linkForm").valid()&&(link=$("#link").val(),title=$("#title").val(),flag=1,reload=1,jsonData={title:title,editorValue:link,status:"link_list"}),1==flag&&(clickOnSave("/canned/links/save","POST",jsonData),$("#modal-link").modal("hide"),1==reload&&setTimeout(location.reload.bind(location),1500))})),$(".main-body .page-wrapper").find("#canned-message-settings-container").length&&($(document).on("click",".edit_canned_message",(function(){var id=$(this).attr("id");$.ajax({url:SITE_URL+"/canned/messages/edit",data:{id:id,_token:token},type:"POST",dataType:"JSON",success:function(data){$("#edit_title").val(data.title),$("#canned_id").val(data.id),cannedEditorValueEdit.setData(data.message)}})})),$("#editMessageForm").validate({ignore:[],rules:{canned_message:{CKEditorRequired:!0},title:{required:!0,maxlength:150}}}),$("#editMessageForm").on("submit",(function(event){if(event.preventDefault(),1==$("#editMessageForm").valid()){let title=$("#edit_title").val(),id=$("#canned_id").val();clickOnSave("/canned/messages/update","POST",jsonData={id:id,title:title,editorValue:cannedEditorValueEdit.getData()}),$("#edit-canned-message").modal("hide"),setTimeout(location.reload.bind(location),1500)}})),$("#modal-canned").on("hidden.bs.modal",(function(e){$(this).find("input[name=title]").val(""),$(this).find("textarea[name=canned_message]").text(""),$("#cannedForm").validate().resetForm(),$(this).find("input[name=title]").removeClass("error"),$(this).find("textarea[name=canned_message]").removeClass("error"),$("#txtAreaCanned").code("")})),$("#edit-canned-message").on("show.bs.modal",(function(e){$("#editMessageForm").validate().resetForm()})),$("#edit-lead-source").on("hidden.bs.modal",(function(e){$(this).find("input[name=title]").removeClass("error"),$(this).find("textarea[name=canned_message]").removeClass("error")})),dataTable("#dataTableBuilder",3),confirmDelete("#confirmDelete","#confirmDeleteSubmitBtn","#confirmDeleteLabel","#delete-canned-")),$(".main-body .page-wrapper").find("#canned-links-settings-container").length&&($(document).on("click",".edit_canned_link",(function(){var id=$(this).attr("id");$.ajax({url:SITE_URL+"/canned/links/edit",data:{id:id,_token:token},type:"POST",dataType:"JSON",success:function(data){$("#edit_link").val(data.link),$("#edit_title").val(data.title),$("#link_id").val(data.id)}})})),$("#editLinkForm").validate({ignore:[],rules:{link:{required:!0,regexLink:!0,maxlength:255},title:{required:!0,maxlength:150}}}),$("#editLinkForm").on("submit",(function(event){if(event.preventDefault(),1==$("#editLinkForm").valid()){let title=$("#edit_title").val(),link=$("#edit_link").val(),linkId=$("#link_id").val();clickOnSave("/canned/links/update","POST",jsonData={id:linkId,title:title,editorValue:link,status:"link_list"}),$("#edit-canned-link").modal("hide"),setTimeout(location.reload.bind(location),1500)}})),$("#modal-link").on("hidden.bs.modal",(function(e){$(this).find("input[name=title]").val(""),$(this).find("input[name=link]").val(""),$("#linkForm").validate().resetForm(),$(this).find("input[name=title]").removeClass("error"),$(this).find("input[name=link]").removeClass("error")})),$("#edit-canned-link").on("show.bs.modal",(function(e){$("#editLinkForm").validate().resetForm()})),$("#edit-canned-link").on("hidden.bs.modal",(function(e){$(this).find("input[name=title]").removeClass("error"),$(this).find("input[name=link]").removeClass("error")})),dataTable("#dataTableBuilder",3),confirmDelete("#confirmDelete","#confirmDeleteSubmitBtn","#confirmDeleteLabel","#delete-canned-")),$(".main-body .page-wrapper").find("#reply-ticket-container").length||$(".main-body .page-wrapper").find("#cus-panel-ticket-reply-container").length){function urlify(text){let link=[];var urlRegex=/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g;let i=0;return text.replace(urlRegex,(function(url){link[i++]=url})),link}$(".main-body .page-wrapper").find("#reply-ticket-container").length&&($(".canned-btn").on("click",(function(){var temp=$(".ck-content").children("p.first").val()})),$(document).on("click","#canned_msg",(function(event){event.preventDefault()})),$(document).on("click","#canned_link",(function(event){event.preventDefault();let getLink=urlify($(".txtAreaCanned").summernote("code"));if(getLink.length>0){jsonData={editorValue:getLink};let customLink="",rowid=1;for(let i=0;i<getLink.length;++i)customLink+=`\n                          <div class="row customLinkDiv" id="rowid-${rowid}">\n                             <div class="col-md-5 col-sm-5 padding-bottom">\n                                <label class="col-sm-2 control-label require">${jsLang("Title")}</label>\n                                <input type="text" data-rel="${rowid}" data-text="link-title-text" name="title[]" class="form-control" id="link-title-${rowid}">\n                                <span id="link-title-text-${rowid}" class="validationMsg"></span>\n                             </div>\n                             <div class="col-md-6 col-sm-6">\n                                 <label class="col-sm-2 control-label require">${jsLang("Link")}</label>\n                                <input type="text" data-rel="${rowid}" data-text="link-text" name="link[]" value="${getLink[i]}" class="form-control" id="link-${rowid}">\n                                <span id="link-text-${rowid}" class="validationMsg"></span>\n                             </div>\n                             <input type="hidden" name="row_identify[]" value="${rowid}">\n                             <div class="col-md-1 co-sm-1">\n                                <label>${jsLang("Action")}</label>\n                                <button type="button" data-row-id="${rowid}" class="btn btn-xs btn-danger m-t-5 deleteCustomLink"><i class="fa fa-trash"></i></button>\n                             </div>\n                           </div>`,rowid++;$("#custom_link").empty(),$("#custom_link").append(customLink),$("#modal-link").modal("show")}else swal(jsLang("Does not find any link!"),{icon:"error",buttons:[!1,jsLang("Ok")]})}))),$("#modal-canned").on("show.bs.modal",(function(e){$(e.relatedTarget).attr("data-id")&&$("#txtAreaCanned").summernote("code",$(e.relatedTarget).attr("data-message"))}))}