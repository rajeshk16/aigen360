"use strict";$.fn.isInViewport=function(){return 0!=this.length&&this[0].getBoundingClientRect().top<$(window).height()};class AjaxRequest{static async call(t,e={}){return await fetch(t,Object.assign({method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}},e)).then(t=>t.json()).then(t=>t.response)}}class Dashboard{element;fetched=!1;links=[];params={};static getObject(){return null==this.myself&&(this.myself=new this),this.myself}async update(t){this.fetched=!0;let e=await AjaxRequest.call(t,this.params);if(this.getStatus(e))this.renderData(this.element,e);else throw Error(this.getErrMessage(e))}dataAlreadyFetched(t){return void 0!=dashboardAjaxData[t]}getFromFetchedData(t){return dashboardAjaxData[t]}sliceData(t,e=5){return t.slice(0,e)}switchView(){this.element.find(".placeholder-data").addClass("d-none"),this.element.find(".original-data").removeClass("d-none")}sync(t){this.hasObject()&&!this.fetched&&this.element.isInViewport()&&t&&this.update(t)}hasObject(){return void 0!=this.element&&!(this.element.length<1)}renderData(){throw Error("Must implement renderData() method.")}getStatus(t){return!!t.status&&!!t.status.code&&200==t.status.code}getErrMessage(t){return t.status.message}formatString(t,e=20,s="..."){return t.length>e-s.length?t.substr(0,e)+s:t}formatUrl(t,e,s=null){return s?t.replace(s,e):t.replace("__id__",e)}addLink(t,e){return this.links[e]=t,this}getLink(t,e,s=null){return void 0==this.links[t]?"#":s?this.links[t].replace(s,e):this.links[t].replace("__id__",e)}setParams(t){return this.params=t,this}resetFetch(){return this.fetched=!1,this}}class latestRegistration extends Dashboard{static myself=null;constructor(){super(),super.element=$("#latest-registration")}renderData(t,e){e=super.sliceData(e.records);let s="";e.forEach(t=>{s+='<tr class="unread">',s+='<td><h6 class="mb-0">'+t.name.substr(0,20)+"</h6></td>",s+='<td><h6 class="mb-0">'+t.status+"</h6></td>",s+='<td class="text-center"> <h6 class="text-muted mb-0">'+t.created_at+"</h6></td>",s+='<td class="text-center"> <a target="_blank" href="'+t.view+'" class="label view-color-btn text-2c f-12">'+jsLang("View")+"</a>",s+="</tr>"}),0==e.length&&(t.find(".original-data").siblings("thead").remove(),s=`<tr class="border-0"><td colspan="2" class="border-0">${jsLang("No data found.")}</td></tr>`),t.find(".original-data").append(s),super.switchView()}}class latestTransaction extends Dashboard{static myself=null;constructor(){super(),super.element=$("#latest-transaction")}renderData(t,e){e=super.sliceData(e.records);let s="";e.forEach(t=>{var e;s+='<tr class="unread">',s+='<td><h6 class="mb-0 pt-1">'+(null==t.user_name?jsLang("Unknown"):t.user_name.substr(0,20))+"</h6></td>",s+='<td><h6 class="mb-0">'+t.package_name+"</h6></td>",s+='<td><h6 class="mb-0">'+t.price+"</h6></td>",s+='<td><h6 class="mb-0">'+t.status+"</h6></td>",s+='<td class="text-center"> <h6 class="text-muted mb-0">'+t.date+"</h6></td>",s+="</tr>"}),0==e.length&&(t.find(".original-data").siblings("thead").remove(),s=`<tr class="border-0"><td colspan="2" class="border-0">${jsLang("No data found.")}</td></tr>`),t.find(".original-data").append(s),super.switchView()}}var ctx=$("#chart-area-2");ctx.height(335);class salesOfTheMonth extends Dashboard{static myself=null;constructor(){super(),super.element=$("#sale-of-this-month")}renderData(t,e){this.lineChart(t,e),super.switchView()}lineChart=(t,e)=>{t.find(".placeholder").addClass("d-none");let s=t.find("#chart-area-2");s.removeClass("d-none"),this.updateChart(s[0],e.records)};dayMonth(t){let e=new Date;e.setMonth(t-1);let s=e.toLocaleString(localeString,{year:"numeric"});return t<=0&&(t+=12),e.toLocaleString(localeString,{month:"short"})+" "+s}monthToColor(t){var e;return t%3==0?"rgba(252, 202, 25, 1)":t%3==1?"rgba(227, 147, 255, 1)":"rgba(0, 223, 255, 1)"}updateChart=(t,e)=>{var s=t.getContext("2d"),a=[];for(let r in e.values){var n=s.createLinearGradient(0,0,500,0);n.addColorStop(1,this.monthToColor(r));let l={label:this.dayMonth(r),data:e.values[r],borderWidth:4,borderColor:n,backgroundColor:n,hoverborderColor:n,hoverBackgroundColor:n,tension:.1};a.push(l)}var i={labels:e.dates,datasets:a},d=new Chart(s,{type:"line",data:i,responsive:!0,fill:!0,options:{scales:{y:{title:{display:!0,text:jsLang("Sales")}}}}})}}$(document).ready(function(){let t=()=>{salesOfTheMonth.getObject().sync(saleOfThisMonth),latestTransaction.getObject().sync(latestTransactionUrl),"undefined"!=typeof latestRegistrationUrl&&latestRegistration.getObject().addLink(latestRegistrationUrl,"edit").sync(latestRegistrationUrl)};function e(){$(".placeholder-data-sta").removeClass("d-none"),$(".original-data-sta").addClass("d-none"),$(".original-data-sta").empty()}$(document).on("scroll",()=>{t()}),t()});